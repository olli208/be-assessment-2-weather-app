<% include partials/head.ejs %>

  <header>
    <% if (user) { %>
    <a href="/logout">logout</a>
    <% } else {%>
    <a href="/login">login</a>
    <a href="/register">register</a>
    <% } %>
  </header>

  <!-- Show pop up message after user updates game -->
  <% if(locals.flashes) { %>
    <% var categories =  Object.keys(flashes); %>
    <% categories.forEach(function (cat) { %>
      <% flashes[cat].forEach(message => { %>
          <div class="flash-message"> 
            <p><%= message %></p> 
          </div>
      <% }) %>
    <% }) %>
  <% } %>

  <% if (user) { %>
  <!-- LOGGED IN --> 

  <section class="">
    <h1>welcome back, <%= user.username %></h1>

    <% if (address) { %>
    <!-- LOGGEN IN WITH ADRESS -->

    <section class="weather_card">
        <h2>the weather in <%= address %> is</h2>
        temp: <%= temp %>
        hourly: <%= hourly %>
        daily: <%= daily %>
    </section>

    <section>
      add location...
      <form action="/add-location" method="post">        
          <fieldset class="add_location">
              <input id="searchTextField" class="maps_autocomplete" type="text" placeholder="search location" name="address" value="<%= address %>" required>
              <input type="hidden" id="location_Lat" name="location_Lat" />
              <input type="hidden" id="location_Lng" name="location_Lng" />             
          </fieldset>

          <input type="submit" value="search">
      </form>

  <% } else { %>
  <!-- LOGGED IN WITHOUT ADDRESS -->
  
  <section class="weather_card">
    <h2>the weather in <%= user.location.address %> is</h2>
    temp: <%= temp %>
    hourly: <%= hourly %>
    daily: <%= daily %>
  </section>

  <% } %>

  </section>

  <% } else { %>

    <% if (address) { %>

      <section>
        Whats the weather in...
        <form action="/get-weather" method="post">        
            <fieldset class="add_location">
                <input id="searchTextField" class="maps_autocomplete" type="text" placeholder="search location" name="address" value="<%= address %>" required>
                <input type="hidden" id="location_Lat" name="location_Lat" />
                <input type="hidden" id="location_Lng" name="location_Lng" />             
            </fieldset>

            <input type="submit" value="search">
        </form>                                         

        <section class="weather_card">
            <h2>the weather in <%= address %> is</h2>
            temp: <%= temp %>     
            hourly: <%= hourly %>
            daily: <%= daily %>
        </section>

    <% } else { %>

    no address
      <section>
        Whats the weather in...
        <form action="/get-weather" method="post">        
            <fieldset class="add_location">
                <input id="searchTextField" class="maps_autocomplete" type="text" placeholder="search location" name="address" required>
                <input type="hidden" id="location_Lat" name="location_Lat" />
                <input type="hidden" id="location_Lng" name="location_Lng" />             
            </fieldset>

            <input type="submit" value="search">
        </form>
      </section>

    <% } %>

  <% } %>



<script>
  var placesAutocomplete = places({
    container: document.querySelector('#searchTextField')
  });
</script>

<% include partials/footer.ejs %>